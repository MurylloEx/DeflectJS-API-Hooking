const DEFLECT_PRE_OPERATION_HOOK=1,DEFLECT_OVERWRITTEN_HOOK=2,DEFLECT_POST_OPERATION_HOOK=4,DEFLECT_NATIVE_PRE_OPERATION_HOOK=8,DEFLECT_NATIVE_OVERWRITTEN_HOOK=16,DEFLECT_NATIVE_POST_OPERATION_HOOK=32,DEFLECT_STATE_WAITING=1,DEFLECT_STATE_HOOKED=2,DEFLECT_STATE_FAILED=4,DEFLECT_STATE_ENQUEUED=8,DEFLECT_STATE_UNHOOKED=16,DEFLECT_STATE_DEQUEUED=32;function deflect_create_hook(t,E,n,e){let _,T=t;switch(void 0!==e&&null!=e||(e=window),void 0===n&&(n=DEFLECT_OVERWRITTEN_HOOK),n){case DEFLECT_PRE_OPERATION_HOOK:_=function(){return E.apply(this,arguments),t.apply(this,arguments)};break;case DEFLECT_OVERWRITTEN_HOOK:_=function(){return E.apply(this,arguments)};break;case DEFLECT_POST_OPERATION_HOOK:_=function(){let n=t.apply(this,arguments);return E.apply(this,arguments),n};break;default:_=function(){return E.apply(this,arguments)}}return Object.defineProperty(_,"name",{value:T.name}),{OriginalFunction:T,OriginalFunctionName:T.name,NewFunction:E,Parent:e,HookType:n,HookState:DEFLECT_STATE_WAITING,HookStub:_,PatchAddr:t,Guid:null}}function deflect_create_native_hook(t,E,n,e){let _=t,T={OriginalFunction:_,OriginalFunctionName:_.name,NewFunction:E,Parent:null,HookType:n,HookState:DEFLECT_STATE_WAITING,HookStub:function(){},PatchAddr:t,Guid:null};switch(void 0!==e&&null!=e||(e=window,T.Parent=e),void 0===n&&(n=DEFLECT_NATIVE_OVERWRITTEN_HOOK),T.HookType){case DEFLECT_NATIVE_PRE_OPERATION_HOOK:T.HookStub=function(){E.apply(this,arguments),deflect_unpatch_original(T);let t=T.Parent[T.OriginalFunctionName].apply(this,arguments);return deflect_patch_original(T),t},T.OriginalFunction=function(){deflect_unpatch_original(T);let t=_.apply(this,arguments);return deflect_patch_original(T),t};break;case DEFLECT_NATIVE_OVERWRITTEN_HOOK:T.HookStub=function(){return E.apply(this,arguments)},T.OriginalFunction=function(){deflect_unpatch_original(T);let t=_.apply(this,arguments);return deflect_patch_original(T),t};break;case DEFLECT_NATIVE_POST_OPERATION_HOOK:T.HookStub=function(){deflect_unpatch_original(T);let t=T.Parent[T.OriginalFunctionName].apply(this,arguments);return deflect_patch_original(T),E.apply(this,arguments),t},T.OriginalFunction=function(){deflect_unpatch_original(T);let t=_.apply(this,arguments);return deflect_patch_original(T),t};break;default:T.HookStub=function(){return E.apply(this,arguments)},T.OriginalFunction=function(){deflect_unpatch_original(T);let t=_.apply(this,arguments);return deflect_patch_original(T),t}}return Object.defineProperty(T.HookStub,"name",{value:_.name}),T}function deflect_generate_guid(){let t="0123456789abcdef",E="";for(let n=0;n<8;n++)E+=t.charAt(Math.floor(Math.random()*t.length));E+="-";for(let n=0;n<3;n++){for(let n=0;n<4;n++)E+=t.charAt(Math.floor(Math.random()*t.length));E+="-"}for(let n=0;n<12;n++)E+=t.charAt(Math.floor(Math.random()*t.length));return E.toUpperCase()}function deflect_enqueue_hook(t,E){if(void 0===E)return t.HookState=DEFLECT_STATE_FAILED,DEFLECT_STATE_FAILED;null==E&&(E=[],t.Guid=deflect_generate_guid());let n,e=!0;for(;e;){e=!1,n=deflect_generate_guid();for(let t=0;t<E.length;t++)E[t].Guid==n&&(e=!0)}return t.Guid=n,t.HookState=DEFLECT_STATE_ENQUEUED,E.push(t),DEFLECT_STATE_ENQUEUED}function deflect_dequeue_hook(t,E){for(let n=0;n<E.length;n++)if(E[n].Guid==t)return E.splice(n,1),E[n].HookState=DEFLECT_STATE_DEQUEUED,DEFLECT_STATE_DEQUEUED;return DEFLECT_STATE_FAILED}function deflect_attach_hook(t){if(void 0===t||null==t)return DEFLECT_STATE_FAILED;for(let E=0;E<t.length;E++)t[E].Parent[t[E].OriginalFunctionName]=t[E].HookStub,t[E].HookState=DEFLECT_STATE_HOOKED;return DEFLECT_STATE_HOOKED}function deflect_detach_hook(t){if(void 0===t||null==t)return DEFLECT_STATE_FAILED;for(let E=0;E<t.length;E++)t[E].Parent[t[E].OriginalFunctionName]=t[E].OriginalFunction,t[E].HookState=DEFLECT_STATE_UNHOOKED;return DEFLECT_STATE_UNHOOKED}function deflect_patch_original(t){return t.HookType!=DEFLECT_NATIVE_PRE_OPERATION_HOOK&&t.HookType!=DEFLECT_NATIVE_OVERWRITTEN_HOOK&&t.HookType!=DEFLECT_NATIVE_POST_OPERATION_HOOK?(t.HookState=DEFLECT_STATE_FAILED,DEFLECT_STATE_FAILED):(t.OriginalFunction=t.Parent[t.OriginalFunctionName],t.Parent[t.OriginalFunctionName]=t.HookStub,t.HookState=DEFLECT_STATE_HOOKED,DEFLECT_STATE_HOOKED)}function deflect_unpatch_original(t){return t.HookType!=DEFLECT_NATIVE_PRE_OPERATION_HOOK&&t.HookType!=DEFLECT_NATIVE_OVERWRITTEN_HOOK&&t.HookType!=DEFLECT_NATIVE_POST_OPERATION_HOOK?(t.HookState=DEFLECT_STATE_FAILED,DEFLECT_STATE_FAILED):(t.HookStub=t.Parent[t.OriginalFunctionName],t.Parent[t.OriginalFunctionName]=t.OriginalFunction,t.HookState=DEFLECT_STATE_UNHOOKED,DEFLECT_STATE_UNHOOKED)}