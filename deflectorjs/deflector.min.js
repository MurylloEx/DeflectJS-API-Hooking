const DEFLECT_PRE_OPERATION_HOOK=1,DEFLECT_OVERWRITTEN_HOOK=2,DEFLECT_POST_OPERATION_HOOK=4,DEFLECT_NATIVE_PRE_OPERATION_HOOK=8,DEFLECT_NATIVE_OVERWRITTEN_HOOK=16,DEFLECT_NATIVE_POST_OPERATION_HOOK=32,DEFLECT_STATE_WAITING=1,DEFLECT_STATE_HOOKED=2,DEFLECT_STATE_FAILED=4,DEFLECT_STATE_ENQUEUED=8,DEFLECT_STATE_UNHOOKED=16,DEFLECT_STATE_DEQUEUED=32;function deflect_create_hook(E,t,e,T){let n,_=E;switch(void 0!==T&&null!=T||(T=window),void 0===e&&(e=DEFLECT_OVERWRITTEN_HOOK),e){case DEFLECT_PRE_OPERATION_HOOK:n=function(){return t.apply(this,arguments),E.apply(this,arguments)};break;case DEFLECT_OVERWRITTEN_HOOK:n=function(){return t.apply(this,arguments)};break;case DEFLECT_POST_OPERATION_HOOK:n=function(){let e=E.apply(this,arguments);return t.apply(this,arguments),e};break;default:n=function(){return t.apply(this,arguments)}}return Object.defineProperty(n,"name",{value:_.name}),{OriginalFunction:_,OriginalFunctionName:_.name,NewFunction:t,Parent:T,HookType:e,HookState:DEFLECT_STATE_WAITING,HookStub:n,PatchAddr:E,Guid:null}}function deflect_create_native_hook(E,t,e,T){let n=E,_={OriginalFunction:n,OriginalFunctionName:n.name,NewFunction:t,Parent:T,HookType:e,HookState:DEFLECT_STATE_WAITING,HookStub:function(){},PatchAddr:E,Guid:null};switch(void 0!==T&&null!=T||(T=window),void 0===e&&(e=DEFLECT_NATIVE_OVERWRITTEN_HOOK),_.HookType){case DEFLECT_NATIVE_PRE_OPERATION_HOOK:_.HookStub=function(){t.apply(this,arguments),deflect_unpatch_original(_);let E=_.Parent[_.OriginalFunctionName].apply(this,arguments);return deflect_patch_original(_),E};break;case DEFLECT_NATIVE_OVERWRITTEN_HOOK:_.HookStub=function(){return t.apply(this,arguments)};break;case DEFLECT_NATIVE_POST_OPERATION_HOOK:_.HookStub=function(){deflect_unpatch_original(_);let E=_.Parent[_.OriginalFunctionName].apply(this,arguments);return deflect_patch_original(_),t.apply(this,arguments),E};break;default:_.HookStub=function(){return t.apply(this,arguments)}}return Object.defineProperty(_.HookStub,"name",{value:n.name}),_}function deflect_generate_guid(){let E="0123456789abcdef",t="";for(let e=0;e<8;e++)t+=E.charAt(Math.floor(Math.random()*E.length));t+="-";for(let e=0;e<3;e++){for(let e=0;e<4;e++)t+=E.charAt(Math.floor(Math.random()*E.length));t+="-"}for(let e=0;e<12;e++)t+=E.charAt(Math.floor(Math.random()*E.length));return t.toUpperCase()}function deflect_enqueue_hook(E,t){if(void 0===t)return E.HookState=DEFLECT_STATE_FAILED,DEFLECT_STATE_FAILED;null==t&&(t=[],E.Guid=deflect_generate_guid());let e,T=!0;for(;T;){T=!1,e=deflect_generate_guid();for(let E=0;E<t.length;E++)t[E].Guid==e&&(T=!0)}return E.Guid=e,E.HookState=DEFLECT_STATE_ENQUEUED,t.push(E),DEFLECT_STATE_ENQUEUED}function deflect_dequeue_hook(E,t){for(let e=0;e<t.length;e++)if(t[e].Guid==E)return t.splice(e,1),t[e].HookState=DEFLECT_STATE_DEQUEUED,DEFLECT_STATE_DEQUEUED;return DEFLECT_STATE_FAILED}function deflect_attach_hook(E){if(void 0===E||null==E)return DEFLECT_STATE_FAILED;for(let t=0;t<E.length;t++)E[t].Parent[E[t].OriginalFunctionName]=E[t].HookStub,E[t].HookState=DEFLECT_STATE_HOOKED;return DEFLECT_STATE_HOOKED}function deflect_detach_hook(E){if(void 0===E||null==E)return DEFLECT_STATE_FAILED;for(let t=0;t<E.length;t++)E[t].Parent[E[t].OriginalFunctionName]=E[t].OriginalFunction,E[t].HookState=DEFLECT_STATE_UNHOOKED;return DEFLECT_STATE_UNHOOKED}function deflect_patch_original(E){return E.HookType!=DEFLECT_NATIVE_PRE_OPERATION_HOOK&&E.HookType!=DEFLECT_NATIVE_OVERWRITTEN_HOOK&&E.HookType!=DEFLECT_NATIVE_POST_OPERATION_HOOK?(E.HookState=DEFLECT_STATE_FAILED,DEFLECT_STATE_FAILED):(E.OriginalFunction=E.Parent[E.OriginalFunctionName],E.Parent[E.OriginalFunctionName]=E.HookStub,E.HookState=DEFLECT_STATE_HOOKED,DEFLECT_STATE_HOOKED)}function deflect_unpatch_original(E){return E.HookType!=DEFLECT_NATIVE_PRE_OPERATION_HOOK&&E.HookType!=DEFLECT_NATIVE_OVERWRITTEN_HOOK&&E.HookType!=DEFLECT_NATIVE_POST_OPERATION_HOOK?(E.HookState=DEFLECT_STATE_FAILED,DEFLECT_STATE_FAILED):(E.HookStub=E.Parent[E.OriginalFunctionName],E.Parent[E.OriginalFunctionName]=E.OriginalFunction,E.HookState=DEFLECT_STATE_UNHOOKED,DEFLECT_STATE_UNHOOKED)}